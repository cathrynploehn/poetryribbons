function Audio(t,i,e){function n(){this.timesData=h,this.freqsData=c,this.binCount=a.frequencyBinCount}function r(t){var i=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext;i?context=new i:alert("Sorry, this app is not supported on your browser :(");var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){context.decodeAudioData(n.response,function(t){buffer=t,mainBuffer=buffer,a=context.createAnalyser(),a.connect(context.destination),a.minDecibels=-140,a.maxDecibels=0,c=new Uint8Array(a.frequencyBinCount),h=new Uint8Array(a.frequencyBinCount),e(s)})},n.send()}var s=this;this.SMOOTHING=.5,this.FFT_SIZE=2048,this.context;var o=0,u=0;this.currTime=0,this.lagTime=0,this.mainSource,this.mainBuffer;var a,c,h,m=i;this.isPlaying=!1,this.initialized=!1;var f=1,d=-1;this.activateViz=!0,r(t),this.startSound=function(){this.startTime=context.currentTime,this.lagTime=0===this.currTime?context.currentTime:context.currentTime-this.currTime,mainSource=context.createBufferSource(),mainSource.buffer=mainBuffer,mainSource.loop=!1;var t=context.createScriptProcessor(2048);t.onaudioprocess=this.onProcess,mainSource.connect(t),mainSource.connect(a),mainSource.connect(context.destination),mainSource.start(0,o%buffer.duration),this.isPlaying=!0,this.activateViz&&Animation.draw(this),this.initialized===!1&&(this.initialized=!0)},this.pauseSound=function(){mainSource.stop(),o+=context.currentTime-u,this.currTime=context.currentTime-this.lagTime,time=context.currentTime-this.lagTime,this.isPlaying=!1},this.getTriggers=function(){return m},this.updateTriggers=function(){if(this.currTime>=m[f])for(;this.currTime>=m[f];)d=f,f++,GuiHelper.updateLyrics(f,d);else if(this.currTime<=m[d])for(;this.currTime<=m[d];)d=f,f--,GuiHelper.updateLyrics(f,d);this.currTime=context.currentTime-this.lagTime,time=parseInt(this.currTime/60)+":"+parseInt(this.currTime%60),GuiHelper.updateTimer(time),time=context.currentTime-this.lagTime},this.setTimeLine=function(){var t=0;this.isPlaying&&(-1===d&&(d=0),t=d+1,GuiHelper.markLine(t+1),f!=m.length+1&&(f++,d++,GuiHelper.updateLyrics(f,d)),m[d]=(context.currentTime-this.lagTime).toFixed(3),console.log("Trigger "+d+" set: "+m[d]),GuiHelper.updateTriggers(m))},this.setLine=function(t){if(t>-1&&t<=m.length){var i=!1,e="";this.isPlaying&&(this.pauseSound(),i=!0),-1===d&&(d=0),d=f,f=t,GuiHelper.updateLyrics(f,d),1===t&&(d=-1),o=m[f-1],e+="Start offset:"+o,this.currTime=m[f-1],i&&this.startSound()}},this.incrementLine=function(t){var i=!1,e="";this.isPlaying&&(this.pauseSound(),i=!0),-1===d&&(d=0),1===t&&f!=m.length?(f++,d++,GuiHelper.updateLyrics(f,d)):2===t&&0!==d&&(f--,d--,GuiHelper.updateLyrics(f,f+1)),o=m[f-1],e+="Start offset:"+o,this.currTime=m[f-1],i&&this.startSound()},this.updateVisualData=function(){c=new Uint8Array(a.frequencyBinCount),h=new Uint8Array(a.frequencyBinCount),a.getByteFrequencyData(c),a.getByteTimeDomainData(h);var t=new n;return t}}